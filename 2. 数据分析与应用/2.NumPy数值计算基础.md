## NumPy数值计算基础

### 1. 数组对象ndarray

- ndarray是存储**单一数据类型**的多维数组（python中的列表可以存储多种数据类型），其**以 0 下标**为开始进行集合中元素的索引。

- ndarray 中的每个元素在内存中都有相同存储大小的区域。

- | 属性     | 说明                         |
  | -------- | ---------------------------- |
  | ndim     | 数组的维数                   |
  | shape    | 数组的尺寸（n行m列）         |
  | size     | 元素总数                     |
  | dtype    | 元素的类型                   |
  | itemsize | 数组每个元素的大小 |

#### 1.1 数组的创建

  - `numpy.array(object, dtype = None, copy = True, order = None, subok = False, ndmin = 0)`
  
  - | 名称   | 描述                                                      |
    | :----- | :-------------------------------------------------------- |
    | object | 数组或嵌套的数列                                          |
    | dtype  | 数组元素的数据类型，可选                                  |
    | copy   | 对象是否需要复制，可选                                    |
    | order  | 创建数组的样式，C为行方向，F为列方向，A为任意方向（默认） |
    | subok  | 默认返回一个与基类类型一致的数组                          |
    | ndmin  | 指定生成数组的最小维度                                    |
  
  - ```python
    import numpy as np
    a = np.array([[1, 2 ,3],[4,4,6]])
    b= np.array([[1, 2 ,3],[4,4,6]], dtype=np.float32)
    print(a.size) 
    print(a.shape)
    print(a.dtype)
    print(b.dtype)
    ```

    输出：

    ```
    6
    (2, 3)
    int32
    float32
    ```

  - 重设shape属性：
    ``` python
    a.reshape(3,2)
    ```
    - 输出：
    ```
        array([[1, 2],
               [3, 4],
               [4, 6]])
    ```

##### 其他创建数组的方法

 ######**从数值范围创建数组numpy.arange**

  - 根据 start 与 stop 指定的范围以及 step 设定的步长，生成一个 ndarray。

  - `numpy.arange(start, stop, step, dtype)`

  - 示例：


  ```python
  np.arange(10)
  ```


      array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])

 ######**从数值范围创建等差数列numpy.linspace**

  - 用于创建一个一维数组，数组是一个等差数列构成的。

  - `np.linspace(start, stop, num=50, endpoint=True, retstep=False, dtype=None)`

    | 参数       | 描述                                                         |
    | :--------- | :----------------------------------------------------------- |
    | `start`    | 序列的起始值                                                 |
    | `stop`     | 序列的终止值，如果`endpoint`为`true`，该值包含于数列中       |
    | `num`      | 要生成的等步长的样本数量，默认为`50`                         |
    | `endpoint` | 该值为 `true` 时，数列中包含`stop`值，反之不包含，默认是True。 |
    | `retstep`  | 如果为 True 时，生成的数组中会显示间距，反之不显示。         |
    | `dtype`    | `ndarray` 的数据类型                                         |

  - 


    ```python
    np.linspace(0, 10, 10, endpoint=False)
    ```


        array([0., 1., 2., 3., 4., 5., 6., 7., 8., 9.])

 ###### **从数值范围创建等比数列numpy.logspace**

  - 用于创建一个于等比数列

  - `np.logspace(start, stop, num=50, endpoint=True, base=10.0, dtype=None)`

    | 参数       | 描述                                                         |
    | :--------- | :----------------------------------------------------------- |
    | `start`    | 序列的起始值为：base ** start                                |
    | `stop`     | 序列的终止值为：base ** stop。如果`endpoint`为`true`，该值包含于数列中 |
    | `num`      | 要生成的等步长的样本数量，默认为`50`                         |
    | `endpoint` | 该值为 `true` 时，数列中中包含`stop`值，反之不包含，默认是True。 |
    | `base`     | 对数 log 的底数。                                            |
    | `dtype`    | `ndarray` 的数据类型                                         |

  - 


    ```python
    np.logspace(0, 10, 10, endpoint=False, base=2)
    ```


        array([  1.,   2.,   4.,   8.,  16.,  32.,  64., 128., 256., 512.])

 ###### **numpy.empty**

  - 来创建一个指定形状（shape）、数据类型（dtype）且未初始化的数组。

  - `numpy.empty(shape, dtype = float, order = 'C')`

    | 参数  | 描述                                                         |
    | :---- | :----------------------------------------------------------- |
    | shape | 数组形状                                                     |
    | dtype | 数据类型，可选                                               |
    | order | 有"C"和"F"两个选项,分别代表，行优先和列优先，在计算机内存中的存储元素的顺序。 |

  - ```
    x = np.empty([3,2], dtype = int) 
    ```

 ######  **numpy.zeros**

  - 创建指定大小的数组，数组元素以 0 来填充：

  - `numpy.zeros(shape, dtype = float, order = 'C')`

  - ```python
    # 默认为浮点数
    x = np.zeros(5) 
    print(x)
     
    # 设置类型为整数
    y = np.zeros((5,), dtype = np.int) 
    print(y)
     
    # 自定义类型
    z = np.zeros((2,2), dtype = [('x', 'i4'), ('y', 'i4')])  
    print(z)
    ```

    ```
    [0. 0. 0. 0. 0.]
    [0 0 0 0 0]
    [[(0, 0) (0, 0)]
     [(0, 0) (0, 0)]]
    ```

###### numpy.ones

  - 创建指定形状的数组，数组元素以 1 来填充：

  - `numpy.ones(shape, dtype = None, order = 'C')`

  - ```
    # 默认为浮点数
    x = np.ones(5) 
    print(x)
     
    # 自定义类型
    x = np.ones([2,2], dtype = int)
    print(x)
    ```

    ```
    [1. 1. 1. 1. 1.]
    [[1 1]
     [1 1]]
    ```


###### np.eye

- 


  ```python
  np.eye(3)
  ```

  


      array([[1., 0., 0.],
             [0., 1., 0.],
             [0., 0., 1.]])


###### np.diag


```python
np.diag([1,2,3])
```




    array([[1, 0, 0],
           [0, 2, 0],
           [0, 0, 3]])

### 2. NumPy数据类型

- 常用NumPy基本类型

  | 名称       | 描述                                                         |
  | :--------- | :----------------------------------------------------------- |
  | bool_      | 布尔型数据类型（True 或者 False）                            |
  | int_       | 默认的整数类型（类似于 C 语言中的 long，int32 或 int64）     |
  | intc       | 与 C 的 int 类型一样，一般是 int32 或 int 64                 |
  | intp       | 用于索引的整数类型（类似于 C 的 ssize_t，一般情况下仍然是 int32 或 int64） |
  | int8       | 字节（-128 to 127）                                          |
  | int16      | 整数（-32768 to 32767）                                      |
  | int32      | 整数（-2147483648 to 2147483647）                            |
  | int64      | 整数（-9223372036854775808 to 9223372036854775807）          |
  | uint8      | 无符号整数（0 to 255）                                       |
  | uint16     | 无符号整数（0 to 65535）                                     |
  | uint32     | 无符号整数（0 to 4294967295）                                |
  | uint64     | 无符号整数（0 to 18446744073709551615）                      |
  | float_     | float64 类型的简写                                           |
  | float16    | 半精度浮点数，包括：1 个符号位，5 个指数位，10 个尾数位      |
  | float32    | 单精度浮点数，包括：1 个符号位，8 个指数位，23 个尾数位      |
  | float64    | 双精度浮点数，包括：1 个符号位，11 个指数位，52 个尾数位     |
  | complex_   | complex128 类型的简写，即 128 位复数                         |
  | complex64  | 复数，表示双 32 位浮点数（实数部分和虚数部分）               |
  | complex128 | 复数，表示双 64 位浮点数（实数部分和虚数部分）               |

  numpy 的数值类型实际上是 dtype 对象的实例，并对应唯一的字符，包括 np.bool_，np.int32，np.float32，等等。

  

  ### 3.生成随机数

#### 3.1 无约束生成随机数

`np.random.random(size)`

size表示大小，取[0, 1)之间随机浮点数

如：

```
np.random.random(size=5)
```

```
array([0.84427904, 0.33369141, 0.5917814 , 0.19056518, 0.14130446])
```

又如：

```
np.random.random(size=(2,3))
```

```
array([[0.94507326, 0.15417911, 0.53487395],
       [0.75745161, 0.02841246, 0.50830068]])
```

#### 3.2 生成服从均匀分布的随机数

`np.random.rand(d0, d1, ..., dh)`

按给定数组尺寸维度生成随机数。如：

```
np.random.rand(2,3,4)
```

```
array([[[0.8672972 , 0.12856069, 0.89570326, 0.74243739],
        [0.3693808 , 0.58828413, 0.13618014, 0.38748339],
        [0.66181565, 0.88799405, 0.83425269, 0.7250403 ]],

       [[0.48612192, 0.24787641, 0.75843473, 0.29524774],
        [0.54503633, 0.77473247, 0.24695983, 0.41065317],
        [0.12653022, 0.34013652, 0.61366594, 0.01157614]]])
```

#### 3.3 生成服从正态分布的随机数

`np.random.randn(d0, d1, …, dh)`

如：

```
np.random.randn(2,3,4)
```

```
array([[[-0.74098059, -1.4723497 ,  0.38429765, -0.02862567],
        [ 0.19180714, -1.34303691, -0.5227248 ,  0.41156881],
        [ 0.4952934 ,  1.34008103, -0.23557854,  0.40247379]],

       [[ 0.18050854,  0.02519874, -0.32327983,  1.63725585],
        [ 1.38934151, -0.72491878, -0.33435845, -0.27563113],
        [ 0.14908191,  1.24866097,  0.17803479,  0.30927276]]])
```

#### 3.4 生成给定上下范围内的随机整数

`np.random.randint(low, hight, size, dtype)`

如创建一个最小值不低于2，最大值不高于10的2行5列的数组：

```
np.random.randint(2,10,size=[2,5])
```

```
array([[9, 3, 3, 2, 6],
       [8, 4, 6, 9, 2]])
```

#### 3.5 random模块常用随机数生成函数

| **函数**        | **说明**                                         |
| --------------- | ------------------------------------------------ |
| **seed**        | 确定随机数生成器的种子。                         |
| **permutation** | 返回一个序列的随机排列或返回一个随机排列的范围。 |
| **shuffle**     | 对一个序列进行随机排序。                         |
| **binomial**    | 产生二项分布的随机数。                           |
| **normal**      | 产生正态（高斯）分布的随机数。                   |
| **beta**        | 产生beta分布的随机数。                           |
| **chisquare**   | 产生卡方分布的随机数。                           |
| **gamma**       | 产生gamma分布的随机数。                          |
| **uniform**     | 产生在[0,1)中均匀分布的随机数。                  |

### 4. 通过索引访问数组

#### 4.1 一维数组的索引

> 索引从0开始

- ```python
arr = np.arange(10)  # array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
print('索引结果为：', ar[5]) #用整数作为下标可以获取数组中的某个元素
	```
	```
索引结果为：5
	```

- ```python
	print('索引结果为：', ar[3:5]) #用范围作为下标获取数组的一个切片，包括arr[3]不包括arr[5]
	```
	```
	索引结果为：[3 4]
	```
- ```python
	print('索引结果为：', arr[:5]) #省略开始下标，表示从ar[0]开始
	```
	```
	索引结果为：[0 1 2 3 4]
	```
- ```python
	print('索引结果为：', arr[-1]) #下标可以使用负数，-1表示从数组后往前数的第一个元素
	```
	```
	索引结果为：9
	```

- ```python
   arr[2:4]=100,101 #下标还可以用来修改元素的值
   print('索引结果为:', arr) 
   ```
   ```
   索引结果为:[0  1  100  101  4  5 6 7 8 9]
   ```
- ```python
  print('索引结果为:', arr[1:-1:2]) #范围中的第三个参数表示步长,2表示隔一个元素取一个元素
	```
	```
   索引结果为:[1 101  5  7]
  ```
- ```python
   print('索引结果为:', ar[5:1:-2])#步长为负数时,开始下标必须大于结束下标
   ```
   ```
   索引结果为:[5  101]
   ```

#### 4.2 多维数组的索引

- ```python
  arr = np.array([[1, 2 , 3, 4, 5], [4, 5, 6, 7, 8, ], [7, 8, 9, 10, 11,]])
  print('创建的二维数组为：', arr)
  ```

  ```
  创建的二维数组为： [[ 1  2  3  4  5]
   [ 4  5  6  7  8]
   [ 7  8  9 10 11]]
  ```

- ```python
  print('索引结果为：', arr[0, 3:5])  #索引第0行中第3和4列的元素
  ```

  ```
  索引结果为： [4 5]
  ```

- ```python
  print('索引结果为：',arr[1:, 2:])   #索引第2和3行中第3～5列的元素
  ```

  ```
  索引结果为： [[ 6  7  8]
   [ 9 10 11]]
  ```

- ```python
  print('索引结果为：',arr[:, 2])  #索引第2列的元素
  ```

  ```
  索引结果为： [3 6 9]
  ```

- ```python
  print('索引结果为：',arr[[(0,1,2), (1,2,3)]]) #从两个序列的对应位置取出两个整数来组成下标：arr[0,1], arr[1,2], arr[2,3]
  ```

  ```
  索引结果为： [ 2  6 10]
  ```

- ```python
  print('索引结果为：',arr[1:, (0,2,3)])  #索引第2、3行中第0、2、3列的元素
  ```

  ```
  索引结果为： [[ 4  6  7]
   [ 7  9 10]]
  ```

- **使用布尔值索引访问数据**

  ```python
  mask = np.array([1,0,1],dtype = np.bool)
  print('索引结果为：',arr[mask,2])  #mask是一个布尔数组，该句索引第1、3行中第2列的元素
  ```

  ```
  索引结果为： [3 9]
  ```

   

### 5. 变换数组的形态

#### 5.1 reshape

#### 5.2 使用ravel函数展平数组

- ```python
  arr = np.arange(12).reshape(3,4)
  print('创建的二维数组为：',arr)
  ```

  ```
  创建的二维数组为：
   [[ 0  1  2  3]
   [ 4  5  6  7]
   [ 8  9 10 11]]
  ```

- ```python
  print('数组展平后为：',arr.ravel())
  ```

  ```
  数组展平后为：  [ 0  1  2  3  4  5  6  7  8  9 10 11]
  ```

#### 5.3 使用flatten函数展平数组

- ```python
  print('数组展平为：',arr.flatten())  #横向展平
  ```

  ```
  数组展平为： [ 0  1  2  3  4  5  6  7  8  9 10 11]
  ```

- ```python
  print('数组展平为：',arr.flatten(order='F'))  #纵向展平
  ```

  ```
  数组展平为： [ 0  4  8  1  5  9  2  6 10  3  7 11]
  ```

#### 5.4 组合数组

- 使用hstack函数实现数组横向组合：`np.hstack((arr1,arr2))`

- 使用vstack函数实现数组纵向组合：`np.vstack((arr1,arr2))`

- 使用concatenate函数实现数组横向组合：`np.concatenate((arr1,arr2),axis = 1))`

- 使用concatenate函数实现数组纵向组合：`np.concatenate((arr1,arr2),axis = 0))`

#### 5.5 切割数组

- 使用hsplit函数实现数组横向分割： `np.hsplit(arr1, 2)`

- 使用vsplit函数实现数组纵向分割： `np.vsplit(arr, 2)`

- 使用split函数实现数组横向分割： `np.split(arr, 2, axis=1)`

- 使用split函数实现数组纵向分割： `np.split(arr, 2, axis=0)`

### 6. NumPy矩阵

#### 6.1 创建NumPy矩阵

- 使用mat函数创建矩阵： 

  ```
  np.mat("1 2 3;4 5 6;7 8 9")
  np.mat([[1, 2], [3, 4]])
  ```

  ```
  matrix([[2, 3],
          [4, 5]])
  matrix([[1, 2],
          [3, 4]])
  ```

- 使用matrix函数创建矩阵：`matr2 = np.matrix([[1 2 3],[4 5 6],[7 8 9]])`

- 使用bmat函数合成矩阵：`np.bmat("arr1 arr2; arr1 arr2")`

  ```
  np.bmat('a b; b a')
  ```

  ```
  matrix([[2, 3, 1, 2],
          [4, 5, 3, 4],
          [1, 2, 2, 3],
          [3, 4, 4, 5]])
  ```

#### 6.2 矩阵的运算

- 矩阵与数相乘：matr1*3

- 矩阵相加减：matr1±matr2

- 矩阵相乘：matr1*matr2

- 矩阵对应元素相乘：np.multiply(matr1,matr2)

- 矩阵的特有属性：

  | **属性** | **说明**                        |
  | -------- | ------------------------------- |
  | **T**    | 返回自身的转置                  |
  | **H**    | 返回自身的共轭转置              |
  | **I**    | 返回自身的逆矩阵                |
  | **A**    | 返回自身数据的2维数组的一个视图 |

### 7. 通用函数ufunc与NumPy 广播(Broadcast)机制

#### 7.1 通用函数

- 是一种能够对数组中所有元素进行操作的函数。

- 四则运算：加（+）、减（-）、乘（*）、除（/）、幂（**）。数组间的四则运算表示对每个数组中的元素分别进行四则运算，所以形状必须相同。

- 比较运算：>、<、==、>=、<=、!=。比较运算返回的结果是一个布尔数组，每个元素为每个数组对应元素的比较结果。

- 逻辑运算：np.any函数表示逻辑“or”，np.all函数表示逻辑“and”。运算结果返回布尔值。

#### 7.2 ufunc函数的广播机制

- 广播（broadcasting）是指不同形状的数组之间执行算术运算的方式。需要遵循4个原则。
  - 让所有输入数组都向其中shape最长的数组看齐，shape中不足的部分都通过在前面加1补齐。
  - 输出数组的shape是输入数组shape的各个轴上的最大值。
  - 如果输入数组的某个轴和输出数组的对应轴的长度相同或者其长度为1时，这个数组能够用来计算，否则出错。
  - 当输入数组的某个轴的长度为1时，沿着此轴运算时都用此轴上的第一组值。

### 8. NumPy读写文件

> NumPy文件读写主要有二进制的文件读写和文件列表形式的数据读写两种形式

- save函数是以二进制的格式保存数据到一个npy文件。` np.save("../tmp/save_arr",arr)`

- load函数是从二进制的文件中读取数据。 `np.load("../tmp/save_arr.npy")`

- savez函数可以将多个数组保存到一个npz文件中。 `np.savez('../tmp/savez_arr',arr1,arr2)`

- 存储时可以省略扩展名，但读取时不能省略扩展名。

- 读取文本格式的数据

  - savetxt函数是将数组写到某种分隔符隔开的文本文件中。`np.savetxt("../tmp/arr.txt",  arr,  fmt="%d",  delimiter="," )`

  - loadtxt函数执行的是把文件加载到一个二维数组中。`np.loadtxt("../tmp/arr.txt", delimiter=",")`

  - genfromtxt函数面向的是结构化数组和缺失数据。

     `np.genfromtxt("../tmp/arr.txt",  delimiter = ",")`

### 9. numpy简单统计分析

#### 9.1 排序

##### 9.1.1 直接排序

- sort函数是最常用的排序方法。 `arr.sort()`

- sort函数也可以指定一个axis参数，使得sort函数可以沿着指定轴对数据集进行排序。axis=1为沿横轴排序； axis=0为沿纵轴排序。

##### 9.1.2 间接排序

- argsort函数返回值为重新排序值的下标。 arr.argsort()

- lexsort函数返回值是按照最后一个传入数据排序的。 np.lexsort((a,b,c))

#### 9.2 去重与重复数据

- 通过unique函数可以找出数组中的唯一值并返回已排序的结果。

- tile函数主要有两个参数，参数“A”指定重复的数组，参数“reps”指定重复的次数。`np.tile(A，reps)`

- repeat函数主要有三个参数，参数“a”是需要重复的数组元素，参数“repeats”是重复次数，参数“axis”指定沿着哪个轴进行重复，axis = 0表示按行进行元素重复；axis = 1表示按列进行元素重复。`numpy.repeat(a, repeats, axis=None)`

- 这两个函数的主要区别在于，tile函数是对数组进行重复操作，repeat函数是对数组中的每个元素进行重复操作。
- ```python
  a = np.random.random(size= 3) 
  # 输出：array([0.73749178, 0.39437899, 0.11991986])
  np.repeat(a, 2)
	```
	
	```
  array([0.73749178, 0.73749178, 0.39437899, 0.39437899, 0.11991986,0.11991986])
	```

- ```python
	np.tile(a, 2 )
	```

	```
	array([0.73749178, 0.39437899, 0.11991986, 0.73749178, 0.39437899,0.11991986])
	```

- ```python
  c = np.tile(a, 2 )
  np.unique(c)
  ```

  ```
  array([0.11991986, 0.39437899, 0.73749178])
  ```

#### 9.3 常用统计函数

> 当axis=0时，表示沿着纵轴计算。当axis=1时，表示沿着横轴计算。默认时计算一个总值。

| **函数**    | **说明**               |
| ----------- | ---------------------- |
| **sum**     | 计算数组的和           |
| **mean**    | 计算数组均值           |
| **std**     | 计算数组标准差         |
| **var**     | 计算数组方差           |
| **min**     | 计算数组最小值         |
| **max**     | 计算数组最大值         |
| **argmin**  | 返回数组最小元素的索引 |
| **argmax**  | 返回数组最小元素的索引 |
| **cumsum**  | 计算所有元素的累计和   |
| **cumprod** | 计算所有元素的累计积   |

