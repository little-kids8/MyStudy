# ç‰¹å¾å·¥ç¨‹

[TOC]



## 1. ç‰¹å¾å·¥ç¨‹æ¦‚å†µ

### 1.1 ç‰¹å¾å·¥ç¨‹æ˜¯ä»€ä¹ˆ

- å°†æ•°æ®è½¬æ¢ä¸ºèƒ½æ›´å¥½åœ°è¡¨ç¤ºæ½œåœ¨é—®é¢˜çš„ç‰¹å¾ï¼Œä»è€Œæé«˜æœºå™¨å­¦ä¹ çš„æ€§èƒ½ã€‚
- å†—ä½™å±æ€§çš„å½±å“ï¼š
  - æ¨¡å‹è¿‡æ‹Ÿåˆ
  - æ—¶é—´æˆæœ¬é«˜

- >  æœ‰è¿™ä¹ˆä¸€å¥è¯åœ¨ä¸šç•Œå¹¿æ³›æµä¼ ï¼šæ•°æ®å’Œç‰¹å¾å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œæ¨¡å‹å’Œç®—æ³•åªæ˜¯é€¼è¿‘è¿™ä¸ªä¸Šé™è€Œå·²ã€‚é‚£ç‰¹å¾å·¥ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€é¡¹å·¥ç¨‹æ´»åŠ¨ï¼Œç›®çš„æ˜¯æœ€å¤§é™åº¦åœ°ä»åŸå§‹æ•°æ®ä¸­æå–ç‰¹å¾ä»¥ä¾›ç®—æ³•å’Œæ¨¡å‹ä½¿ç”¨ã€‚é€šè¿‡æ€»ç»“å’Œå½’çº³ï¼Œäººä»¬è®¤ä¸ºç‰¹å¾å·¥ç¨‹åŒ…æ‹¬ä»¥ä¸‹æ–¹é¢ï¼š
  >
  > - ![preview](20e4522e6104ad71fc543cc21f402b36_r.jpg)
  > - ä½œè€…ï¼šåŸä¸œ
  >   é“¾æ¥ï¼šhttps://www.zhihu.com/question/29316149/answer/110159647

### 1.2 ç‰¹å¾å·¥ç¨‹çš„æ•ˆæœè¯„ä¼°

1. åœ¨åº”ç”¨ç‰¹å¾å·¥ç¨‹ä¹‹å‰ï¼Œå¾—åˆ°æœºå™¨å­¦ä¹ æ¨¡å‹çš„åŸºå‡†æ€§èƒ½ï¼›

2. åœ¨æœºå™¨å­¦ä¹ æµæ°´çº¿ä¸­åº”ç”¨ä¸€ç§æˆ–å¤šç§ç‰¹å¾å·¥ç¨‹ï¼›

3. å°†åº”ç”¨ç‰¹å¾å·¥ç¨‹åçš„æ¨¡å‹æ€§èƒ½ä¸åŸºå‡†æ€§èƒ½è¿›è¡Œå¯¹æ¯”ã€‚

### 1.3 æ•°æ®çš„å››ä¸ªç­‰çº§

- å®šé‡

  - å®šé‡æ•°æ®æœ¬è´¨ä¸Šæ˜¯æ•°å€¼ï¼Œåº”è¯¥æ˜¯è¡¡é‡æŸæ ·ä¸œè¥¿çš„æ•°é‡ï¼ˆå‡†ç¡®ç‡ï¼š0.98ï¼‰ã€‚

- å®šæ€§

  - å®šæ€§æ•°æ®æœ¬è´¨ä¸Šæ˜¯ç±»åˆ«ï¼Œåº”è¯¥æ˜¯æè¿°æŸæ ·ä¸œè¥¿çš„æ€§è´¨ï¼ˆæ€§åˆ«ï¼šç”·ã€å¥³ï¼‰ã€‚

- å®šé‡è¿˜æ˜¯å®šæ€§ï¼Ÿ

  - > è¯„åˆ†ï¼ˆ1ï½5æ˜Ÿï¼‰ï¼Œæ˜¯å®šé‡è¿˜æ˜¯å®šæ€§ï¼Ÿ
    >
    > - å®šé‡ï¼šæœ‰4.71æ˜Ÿè¿™æ ·çš„å¹³å‡åˆ†åˆ™æ˜¯å®šé‡çš„ã€‚
    >
    > - å®šæ€§ï¼šè®¨åŒã€è¿˜è¡Œã€å–œæ¬¢ã€å–œçˆ±è¿˜æ˜¯ç‰¹åˆ«å–œçˆ±ã€‚

  - **å®šæ€§å’Œå®šé‡ä¹‹é—´å­˜åœ¨æ¨¡ç³Šç•Œé™**

- æ•°æ®çš„å››ä¸ªç­‰çº§

  - å®šç±»ç­‰çº§ï¼ˆnominal levelï¼‰

  - å®šåºç­‰çº§ï¼ˆordinal levelï¼‰

  - å®šè·ç­‰çº§ï¼ˆinterval levelï¼‰

  - å®šæ¯”ç­‰çº§ï¼ˆratio levelï¼‰

  - | ç­‰çº§ | å±æ€§         | æ ·ä¾‹         | æè¿°æ€§ç»Ÿè®¡é‡ |
    | ---- | ------------ | ------------ | ------------ |
    | å®šç±» | ç¦»æ•£ã€æ— åº   | æ€§åˆ«         | é¢‘æ¬¡         |
    | å®šåº | ç¦»æ•£ã€æœ‰åº   | è€ƒè¯•æˆç»©ç­‰çº§ | åˆ†ä½æ•°       |
    | å®šè· | è¿ç»­ã€æœ‰é—´è· | æ‘„æ°åº¦       | é¢‘æ¬¡ã€å‡å€¼   |
    | å®šæ¯” | è¿ç»­ã€æœ‰æ¯”å€¼ | å¢é•¿ç‡       | å…¨éƒ¨         |

#### 1.3.1 å®šç±»ç­‰çº§ï¼ˆnominal levelï¼‰

- å®šç±»ç­‰çº§æ˜¯æ•°æ®çš„ç¬¬ä¸€ä¸ªç­‰çº§ï¼ŒåªæŒ‰åç§°åˆ†ç±»ã€‚
- è¡€å‹ï¼ˆAã€Bã€Oå’ŒABå‹ï¼‰ã€æ€§åˆ«ï¼ˆç”·ã€å¥³ï¼‰åŠ¨ç‰©ç‰©ç§å’Œäººåã€‚
- å¯ä»¥æ‰§è¡Œçš„æ•°å­¦æ“ä½œï¼šç»Ÿè®¡ä¼—æ•°ï¼ˆé¢‘æ¬¡ï¼‰ã€ä¸èƒ½æ‰§è¡Œä»»ä½•å®šé‡æ•°å­¦æ“ä½œã€‚

#### 1.3.2 å®šåºç­‰çº§ï¼ˆordinal levelï¼‰

- **ç±»åˆ«æ•°æ®**ï¼Œå®šåºç­‰çº§çš„æ•°æ®å¯ä»¥è‡ªç„¶æ’åºã€‚
- æå…‹ç‰¹é‡ï¼ˆæ¯”å¦‚1ï½10çš„è¯„åˆ†ï¼‰ï¼›è€ƒè¯•çš„æˆç»©ï¼ˆFã€Dã€Cã€Bã€Aï¼‰ã€‚
- å¯ä»¥æ‰§è¡Œçš„æ•°å­¦æ“ä½œï¼š è®¡æ•°ã€æ¯”è¾ƒå’Œæ’åºã€è®¡ç®—ä¸­ä½æ•°å’Œç™¾åˆ†ä½æ•°

#### 1.3.3 å®šè·ç­‰çº§ï¼ˆinterval levelï¼‰

- **å®šé‡æ•°æ®**ï¼Œå€¼ä¹‹é—´çš„å·®å¼‚æœ‰æ„ä¹‰ï¼Œæ— ç»å¯¹é›¶ç‚¹ã€‚
- ä¾‹ï¼šæ¸©åº¦ï¼š32â„ƒï¼Œ 4â„ƒï¼Œå¯ä»¥è®¡ç®—å‡º32 - 4 = 28â„ƒçš„æ¸©å·®ã€‚
- å¯ä»¥åšåŠ å‡è¿ç®—ï¼Œä¸èƒ½åšä¹˜é™¤è¿ç®—ã€‚

#### 1.3.4 å®šæ¯”ç­‰çº§ï¼ˆratio levelï¼‰

- å®šé‡æ•°æ®ï¼Œæœ€é«˜çº§åˆ«çš„æ§åˆ¶å’Œæ•°å­¦è¿ç®—ï¼Œæœ‰äº†ä¸€ä¸ªç»å¯¹é›¶ç‚¹çš„æ¦‚å¿µï¼Œå¯ä»¥åšä¹˜é™¤è¿ç®—ã€‚
- å¦‚æ¨¡å‹å‡†ç¡®ç‡ã€å›½æ°‘ç”Ÿäº§æ€»å€¼ã€‚

## 2. æ•°æ®é¢„å¤„ç†

### 2.1 æ¢ç´¢æ€§æ•°æ®åˆ†æ

- ç©ºå‡†ç¡®ç‡

  - ç©ºå‡†ç¡®ç‡æ˜¯æŒ‡å½“æ¨¡å‹æ€»æ˜¯é¢„æµ‹é¢‘ç‡è¾ƒé«˜çš„ç±»åˆ«æ—¶è¾¾åˆ°çš„æ­£ç¡®ç‡ã€‚
- ä¸åŒç±»åˆ«æ ·æœ¬çš„å„é¡¹ç‰¹å¾å¯¹æ¯”
- ç¼ºå¤±å€¼æ¢ç´¢

  - è¿›è¡Œæ¢ç´¢æ€§æ•°æ®åˆ†æï¼ˆEDAï¼Œexploratory data analysisï¼‰æ¥è¯†åˆ«ç¼ºå¤±çš„å€¼ã€‚
  - å…¶ä»–éåˆç†å–å€¼


### 2.2 ç¼ºå¤±å€¼å¤„ç†

- åˆ é™¤ç¼ºå¤±å€¼

  

- å¯¹ç¼ºå¤±å€¼è¿›è¡Œå¡«å……

  - 0å¡«å……
  - å‡å€¼å¡«å……ç­‰ç­‰

### 2.3 æ ‡å‡†åŒ–å’Œå½’ä¸€åŒ–

- æ ‡å‡†åŒ–

  - æ ‡å‡†åŒ–çš„ä½œç”¨ï¼šæå‡æ¨¡å‹æ€§èƒ½ï¼›åŠ é€Ÿå­¦ä¹ æ•ˆç‡

  - å¸¸ç”¨æ ‡å‡†åŒ–æ–¹æ³•ï¼š

    - Zåˆ†æ•°æ ‡å‡†åŒ–/ç‰¹å¾æ ‡å‡†åŒ–/æ–¹å·®ç¼©æ”¾ï¼› 

      - é€šè¿‡ç¼©æ”¾ç‰¹å¾ã€ç»Ÿä¸€åŒ–å‡å€¼å’Œæ–¹å·®ï¼ˆæ ‡å‡†å·®çš„å¹³æ–¹ï¼‰
      - Zåˆ†æ•°æ ‡å‡†åŒ–çš„è¾“å‡ºä¼šè¢«é‡æ–°ç¼©æ”¾ï¼Œä½¿å‡å€¼ä¸º0ã€æ ‡å‡†å·®ä¸º1ã€‚
      - z=(x-Î¼)/Ïƒ

    - min-maxæ ‡å‡†åŒ–/min-maxç¼©æ”¾ ï¼›

      - min-maxæ ‡å‡†åŒ–å’ŒZåˆ†æ•°æ ‡å‡†åŒ–ç±»ä¼¼ï¼Œå› ä¸ºå®ƒä¹Ÿç”¨ä¸€ä¸ªå…¬å¼æ›¿æ¢åˆ—ä¸­çš„æ¯ä¸ªå€¼ã€‚
      - m=(x-x_min)/(x_max-x_min)

    - è¡Œå½’ä¸€åŒ–

      - è¿™ä¸ªæ ‡å‡†åŒ–æ–¹æ³•æ˜¯å…³äºè¡Œçš„ã€‚è¡Œå½’ä¸€åŒ–ä¸æ˜¯è®¡ç®—æ¯åˆ—çš„ç»Ÿè®¡å€¼ï¼ˆå‡å€¼ã€æœ€å°å€¼ã€æœ€å¤§å€¼ç­‰ï¼‰ï¼Œè€Œæ˜¯ä¼šä¿è¯æ¯è¡Œæœ‰å•ä½èŒƒæ•°ï¼ˆunit normï¼‰ï¼Œæ„å‘³ç€æ¯è¡Œçš„å‘é‡é•¿åº¦ç›¸åŒã€‚

      - $ğ‘¥=(ğ‘¥_1,ğ‘¥_2, â€¦â€¦ğ‘¥_ğ‘›)$

      - ![image-20211020230821815](image-20211020230821815.png)

      - ![image-20211020230848353](image-20211020230848353.png)

- æœºå™¨å­¦ä¹ æµæ°´çº¿

![image-20211022151300465](image-20211022151300465-16348867821511.png)

> å—å°ºåº¦å½±å“çš„ç®—æ³•ï¼š
>
> - KNNï¼šå› ä¸ºä¾èµ–æ¬§å‡ é‡Œå¾—è·ç¦»ï¼›
> - å‡å€¼èšç±»ï¼šå’ŒKNNçš„åŸå› ä¸€æ ·ï¼›
> - é€»è¾‘å›å½’ã€æ”¯æŒå‘é‡æœºã€ç¥ç»ç½‘ç»œï¼šå¦‚æœä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥å­¦ä¹ æƒé‡ï¼›
> - ä¸»æˆåˆ†åˆ†æï¼šç‰¹å¾å‘é‡å°†åå‘è¾ƒå¤§çš„åˆ—ã€‚

## 3. ç‰¹å¾æ„å»º

### 3.1 å¡«å……åˆ†ç±»ç‰¹å¾

- Imputerï¼šåªèƒ½å¤„ç†æ•´æ•°å‹çš„åˆ†ç±»æ•°æ®

- è‡ªå®šä¹‰è½¬æ¢å™¨ï¼Œæ¥å¡«å……æ¯åˆ—ç¼ºå¤±å€¼

  - åˆ©ç”¨scikit-learnçš„TransformerMixinåŸºç±»åˆ›å»ºè‡ªå®šä¹‰åˆ†ç±»å¡«å……å™¨ã€‚

    ```python
    from sklearn.base import TransformerMixin
    class CustomCategoryImputer(TransformerMixin):   # è‡ªå®šä¹‰åˆ†ç±»å¡«å……å™¨
        def __init__(self, cols=None):
            self.cols = cols
    
        def transform(self, df):
            X = df.copy()
            for col in self.cols:
                X[col].fillna(X[col].value_counts().index[0], inplace=True)
            return X
    
        def fit(self, *_):
            return self
    ```

### 3.2 ç¼–ç åˆ†ç±»å˜é‡

- ä»»ä½•æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œéœ€è¦çš„è¾“å…¥ç‰¹å¾éƒ½å¿…é¡»æ˜¯æ•°å€¼ã€‚

  - å®šç±»ç­‰çº§çš„ç¼–ç 

  - å®šåºç­‰çº§çš„ç¼–ç 

#### 3.2.1 å®šç±»ç­‰çº§çš„ç¼–ç 

- ä¸»è¦æ–¹æ³•æ˜¯å°†åˆ†ç±»æ•°æ®è½¬æ¢ä¸ºè™šæ‹Ÿå˜é‡ï¼ˆdummy variableï¼‰ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š

  1. ç”¨Pandasè‡ªåŠ¨æ‰¾åˆ°åˆ†ç±»å˜é‡å¹¶è¿›è¡Œç¼–ç ï¼›

  2. åˆ›å»ºè‡ªå®šä¹‰è™šæ‹Ÿå˜é‡ç¼–ç å™¨ï¼Œåœ¨æµæ°´çº¿ä¸­å·¥ä½œã€‚

  - è™šæ‹Ÿå˜é‡çš„å–å€¼æ˜¯1æˆ–0ï¼Œä»£è¡¨æŸä¸ªç±»åˆ«çš„æœ‰æ— ï¼Œæ˜¯å®šæ€§æ•°æ®çš„ä»£ç†ã€‚

- pd.get_dummiesï¼šå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„åˆ†ç±»å˜é‡ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºè™šæ‹Ÿå˜é‡ï¼š

- è‡ªå®šä¹‰è™šæ‹Ÿå˜é‡ç¼–ç å™¨

  ```python
  class CustomDummifier(TransformerMixin):   # è‡ªå®šä¹‰è™šæ‹Ÿå˜é‡ç¼–ç å™¨
      def __init__(self, cols=None):
          self.cols = cols
  
      def transform(self, X):
          return pd.get_dummies(X, columns=self.cols)
  
      def fit(self, *_):
          return self
      
      
  cd = CustomDummifier(cols=['boolean', 'city'])
  cd.fit_transform(X)
  ```

#### 3.2.2 å®šåºç­‰çº§çš„ç¼–ç 

- æ ‡ç­¾ç¼–ç å™¨ï¼šé¡ºåºæ•°æ®çš„æ¯ä¸ªæ ‡ç­¾éƒ½ä¼šæœ‰ä¸€ä¸ªç›¸å…³æ•°å€¼ã€‚

- dislikeã€somewhat likeå’Œlike ç”¨0ã€1ã€2æ¥è¡¨ç¤ºã€‚

- `X['ordinal_column'].map(lambda x: ordering.index(x))`

- ```
  ordering = ['dislike', 'somewhat like', 'like']               # 0æ˜¯dislikeï¼Œ1æ˜¯somewhat likeï¼Œ2æ˜¯like
  print(X['ordinal_column'].map(lambda x: ordering.index(x)))   # å°†orderingæ˜ å°„åˆ°é¡ºåºåˆ—
  ```

- å°†è‡ªå®šä¹‰æ ‡ç­¾ç¼–ç å™¨æ”¾è¿›æµæ°´çº¿ä¸­ï¼š

  ```python
  class CustomEncoder(TransformerMixin):  # è¿˜æ˜¯å°†è‡ªå®šä¹‰æ ‡ç­¾ç¼–ç å™¨æ”¾è¿›æµæ°´çº¿ä¸­ï¼š
      def __init__(self, col, ordering=None):
          self.ordering = ordering
          self.col = col
  
      def transform(self, df):
          X = df.copy()
          X[self.col] = X[self.col].map(lambda x: self.ordering.index(x))
          return X
  
      def fit(self, *_):
          return self
      
      
   ce = CustomEncoder(col='ordinal_column', ordering=['dislike', 'somewhat like', 'like'])
  ce.fit_transform(X)
  ```



### 3.3 è¿ç»­ç‰¹å¾åˆ†ç®±

- æœ‰æ—¶éœ€è¦å°†æ•°å€¼æ•°æ®è½¬æ¢ä¸ºåˆ†ç±»å˜é‡ï¼Œå¦‚å¹´é¾„æ®µå¯èƒ½æ¯”å…·ä½“å¹´é¾„æ›´æœ‰ç”¨ã€‚

- `pd.cut(X['quantitative_column'], bins=3)`

  ![image-20211022235711044](image-20211022235711044.png)

- è‡ªå®šä¹‰CustomCutterç±»

  ```python
  class CustomCutter(TransformerMixin):
      def __init__(self, col, bins, labels=False):
          self.labels = labels
          self.bins = bins
          self.col = col
  
      def transform(self, df):
          X = df.copy()
          X[self.col] = pd.cut(X[self.col], bins=self.bins, labels=self.labels)
          return X
  
      def fit(self, *_):
          return self
  
  # æ³¨æ„ï¼Œlabelsçš„é»˜è®¤å€¼æ˜¯Falseã€‚æˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–CustomCutterï¼Œè¾“å…¥éœ€è¦è½¬æ¢çš„åˆ—å’Œåˆ†ç®±æ•°ï¼š
  
  cc = CustomCutter(col='quantitative_column', bins=3)
  cc.fit_transform(X)
  ```

- åˆ›å»ºæµæ°´çº¿

  - å…ˆæ˜¯imputer å¡«å……ç¼ºå¤±å€¼

  - ç„¶åæ˜¯è™šæ‹Ÿå˜é‡ï¼ˆç¼–ç å®šç±»å˜é‡ï¼‰

  - æ¥ç€ç¼–ç é¡ºåºåˆ—ï¼ˆç¼–ç å®šåºå˜é‡ï¼‰

  - æœ€ååˆ†ç®±å®šé‡åˆ—

  - æ‹Ÿåˆæµæ°´çº¿

  ```
  pipe = Pipeline([("imputer", imputer), ('dummify', cd), ('encode', ce), ('cut', cc)])
  pipe.fit(X)
  pipe.transform(X)
  ```



### 3.4 æ‰©å±•æ•°å€¼ç‰¹å¾

- ä¾‹å­ï¼šèƒ¸éƒ¨åŠ é€Ÿåº¦è®¡è¯†åˆ«åŠ¨ä½œæ•°æ®é›†

  - 15åå‚ä¸è€…çš„7ç§åŠ¨ä½œï¼šåºå·ï¼›è½´åŠ é€Ÿåº¦ï¼›è½´åŠ é€Ÿåº¦ï¼›è½´åŠ é€Ÿåº¦ï¼›æ ‡ç­¾ã€‚

  - æ•°æ®é›†æŒ‰å‚ä¸è€…åˆ’åˆ†ï¼Œæ ‡ç­¾æ˜¯æ•°å­—ï¼Œæ¯ä¸ªæ•°å­—ä»£è¡¨ä¸€ç§åŠ¨ä½œï¼ˆactivityï¼‰ã€‚

  - æ ¹æ®æ™ºèƒ½æ‰‹æœºç­‰è®¾å¤‡ä¸ŠåŠ é€Ÿåº¦è®¡çš„xã€yã€zè¯»æ•°è¯†åˆ«ç”¨æˆ·çš„å½“å‰åŠ¨ä½œã€‚

  - > activityåˆ—çš„æ•°å­—æœ‰å¦‚ä¸‹æ„ä¹‰ã€‚
    >
    > 1ï¼šåœ¨ç”µè„‘å‰å·¥ä½œ
    >
    > 2ï¼šç«™ç«‹ã€èµ°è·¯å’Œä¸Šä¸‹æ¥¼æ¢¯
    >
    > 3ï¼šç«™ç«‹
    >
    > 4ï¼šèµ°è·¯
    >
    > 5ï¼šä¸Šä¸‹æ¥¼æ¢¯
    >
    > 6ï¼šä¸äººè¾¹èµ°è¾¹èŠ
    >
    > 7ï¼šç«™ç«‹ç€è®²è¯

- poly = PolynomialFeatures(degree=2, include_bias=False, interaction_only=False)

- æ ¹æ®åŸæœ‰åˆ—çš„ä¹˜ç§¯åˆ›å»ºæ–°åˆ—ï¼Œç”¨äºæ•è·ç‰¹å¾äº¤äº’ï¼Œ[a, b] â€”>[1, a, b, a^2, ab, b^2]

## 4. ç‰¹å¾é€‰æ‹©

- é€‰æ‹©ç‰¹å¾æ˜¯ä¸ºäº†æé«˜é¢„æµ‹èƒ½åŠ›ï¼Œé™ä½æ—¶é—´æˆæœ¬

- ç‰¹å¾é€‰æ‹©çš„æ–¹æ³•ï¼š

  - åŸºäºç»Ÿè®¡çš„ç‰¹å¾é€‰æ‹©

  - åŸºäºæ¨¡å‹çš„ç‰¹å¾é€‰æ‹©

### 4.1 åŸºäºç»Ÿè®¡çš„ç‰¹å¾é€‰æ‹©

#### 4.1.1 çš®å°”é€Šç›¸å…³ç³»æ•°ï¼ˆPearson correlationsï¼‰

- å–å€¼èŒƒå›´[-1, 1],å’Œå“åº”å˜é‡ç›¸å…³ç³»æ•°è¶Šå¤§ï¼Œåˆ™ç‰¹å¾è¶Šæœ‰ç”¨ï¼ˆçœ‹ç»å¯¹å€¼ï¼‰ã€‚

- ç›¸å…³ç³»æ•°ç»å¯¹å€¼å°ï¼Œåˆ™è¯´æ˜ä½œç”¨ä½ï¼Œä¸”å®¹æ˜“åœ¨è®­ç»ƒæ—¶äº§ç”Ÿè¿‡æ‹Ÿåˆã€‚

- å‘ç°å¹¶åˆ é™¤å†—ä½™å˜é‡æ˜¯é™ä½è¿‡æ‹Ÿåˆçš„ä¸€ä¸ªå…³é”®æ–¹æ³•

- ```python
  corr = data.corr() # è®¡ç®—ç›¸å…³ç³»æ•°
  # é€šè¿‡è®¾ç½®ç›¸åº”çš„ç›¸å…³ç³»æ•°é˜ˆå€¼ï¼Œå¯ä»¥å®ç°ç‰¹å¾ç­›é€‰çš„ç›®çš„
  index = corr['default payment next month'].abs() > 0.1
  high_corr_features = corr['default payment next month'].index[index]   # æ‰¾å‡ºç›¸å…³ç³»æ•°å¤§çš„å±æ€§
  X_subset = X.loc[:, high_corr_features.tolist()]
  X_subset.drop('default payment next month', axis=1, inplace=True)
  
  ```

- æ¯”è¾ƒç‰¹å¾é€‰æ‹©å‰åçš„æ¨¡å‹æ€§èƒ½

#### 4.1.2 å‡è®¾æ£€éªŒ

- å‡è®¾ï¼šâ€œæŸä¸ªç‰¹å¾ä¸å“åº”å˜é‡æ²¡æœ‰å…³ç³»â€ï¼ˆé›¶å‡è®¾ï¼‰ã€‚

- å‡è®¾ä¸ºçœŸè¿˜æ˜¯å‡ï¼Ÿ

- Pæ£€éªŒï¼špå€¼ä»‹äº0ã€1ä¹‹é—´ï¼Œpå€¼è¶Šå°åˆ™æ‹’ç»å‡è®¾çš„æ¦‚ç‡å°±è¶Šå¤§ã€‚

- ```python
  from sklearn.feature_selection import SelectKBest, chi2, f_classif
  
  select_model = SelectKBest(score_func=f_classif, k=7)# é€‰æ‹©æœ€ä¼˜çš„kä¸ªç‰¹å¾ï¼Œå‡è®¾æ£€éªŒçš„æ–¹æ³•ä¸ºFåˆ†å¸ƒ
  select_model.fit_transform(X, y)# æ‰§è¡Œå‡è®¾æ£€éªŒï¼Œè®¡ç®—å‡ºpå€¼ï¼Œé€‰æ‹©å‡ºæœ€å°çš„kä¸ªç‰¹å¾
  select_model.get_support() # æŸ¥çœ‹é€‰æ‹©å‡ºçš„æœ€ä¼˜ç‰¹å¾
  
  res = pd.DataFrame({'features': X.columns, 'pvalue': select_model.pvalues_}) # æ„å»ºå‡ºä¸€ä¸ªæ•°æ®æ¡†ï¼Œæ˜¾ç¤ºå‡ºæ¯ä¸ªç‰¹å¾è®¡ç®—å‡ºçš„på€¼
  
  res.sort_values('pvalue', ascending=False) # æŒ‰å‡åºå¯¹på€¼è¿›è¡Œæ’åº
  ```

- æ¯”è¾ƒç‰¹å¾é€‰æ‹©å‰åçš„æ¨¡å‹æ€§èƒ½

- å¯é€šè¿‡ç½‘ç»œæœç´¢ä¼˜åŒ–å»æ‰¾æ›´å¥½çš„å‚æ•°

### 4.2 åŸºäºæ¨¡å‹çš„ç‰¹å¾é€‰æ‹©

#### 4.2.1 åŸºäºæ ‘çš„ç‰¹å¾é€‰æ‹©

- ç”Ÿæˆæ ‘æ—¶ä¼šé€‰æ‹©ä¼˜åŒ–èŠ‚ç‚¹çš„çº¯å‡€åº¦æŒ‡æ ‡ï¼ˆåŸºå°¼ç³»æ•°/ä¿¡æ¯å¢ç›Š/ä¿¡æ¯å¢ç›Šç‡ï¼‰

- ```python
  dct = DecisionTreeClassifier().fit(iris.data, iris.target)
  dct.feature_importances_    # array([0., 0.01333333, 0.06405596, 0.92261071])
  {'importance': dct.feature_importances_, 'features': X.columns}
  
  ```

- 



#### 4.2.2 åŸºäºçº¿æ€§æ¨¡å‹çš„ç‰¹å¾é€‰æ‹©

```
from sklearn.feature_selection import SelectFromModel
from sklearn.linear_model import LinearRegression

model = SelectFromModel(LinearRegression(), threshold=0.01)
model.fit_transform(X, y)
index = model.get_support()
X.columns[index]   # æ‰€é€‰å‡ºæ¥çš„å±æ€§

```

```
from sklearn.feature_selection import SelectFromModel
from sklearn.pipeline import Pipeline
from sklearn.svm import LinearSVC
clf = Pipeline([
  ('feature_selection', SelectFromModel(LinearSVC(penalty="l2"))),
  ('classification', RandomForestClassifier())
])
clf.score(X, y)    #  0.82433ï¼Œå†å²æœ€é«˜å€¼

```

### 4.3 å°ç»“

- 

> å‰äººç»éªŒï¼Œå¯ä»¥åœ¨åˆ¤æ–­ç‰¹å¾é€‰æ‹©æ–¹æ³•çš„ä¼˜åŠ£æ—¶å‚è€ƒ
>
> 1.å¦‚æœç‰¹å¾æ˜¯åˆ†ç±»çš„ï¼Œé‚£ä¹ˆä»SelectKBestå¼€å§‹ï¼Œç”¨å¡æ–¹æˆ–åŸºäºæ ‘çš„é€‰æ‹©å™¨ã€‚
>
> 2.å¦‚æœç‰¹å¾åŸºæœ¬æ˜¯å®šé‡çš„ï¼Œç”¨çº¿æ€§æ¨¡å‹å’ŒåŸºäºç›¸å…³æ€§çš„é€‰æ‹©å™¨ä¸€èˆ¬æ•ˆæœæ›´å¥½ã€‚
>
> 3.å¦‚æœæ˜¯äºŒå…ƒåˆ†ç±»é—®é¢˜ï¼Œè€ƒè™‘ä½¿ç”¨SelectFromModelå’ŒSVCã€‚
>
> 4.åœ¨æ‰‹åŠ¨é€‰æ‹©å‰ï¼Œæ¢ç´¢æ€§æ•°æ®åˆ†æä¼šå¾ˆæœ‰ç›Šå¤„ã€‚
>
> 5.ä¸èƒ½ä½ä¼°é¢†åŸŸçŸ¥è¯†çš„é‡è¦æ€§ã€‚

- ç‰¹å¾é€‰æ‹©çš„å±€é™æ€§
  - å•å˜é‡ç‰¹å¾é€‰æ‹©æ–¹æ³•åœ¨å¤§é‡ç‰¹å¾ä¸Šè¡¨ç°ä¸ä½³ã€‚
  - å¦‚æœä»å¾ˆå¤šç‰¹å¾ï¼ˆè¶…è¿‡100ç§ï¼‰ä¸­é€‰æ‹©ï¼Œé‚£ä¹ˆä¼šå¾ˆéº»çƒ¦ã€‚

## 5. é™ç»´ä¸ç‰¹å¾è½¬æ¢

- ç»´åº¦ç¼©å‡ï¼šç‰¹å¾è½¬æ¢ã€ç‰¹å¾é€‰æ‹©ä¸ç‰¹å¾æ„å»º

  - ç‰¹å¾é€‰æ‹©ä»…é™äºä»åŸå§‹åˆ—ä¸­é€‰æ‹©ç‰¹å¾ï¼›

  - ç‰¹å¾è½¬æ¢ç®—æ³•åˆ™å°†åŸå§‹åˆ—ç»„åˆèµ·æ¥ï¼Œä»è€Œåˆ›å»ºå¯ä»¥æ›´å¥½çš„ç‰¹å¾ã€‚

    

  - ç‰¹å¾é€‰æ‹©çš„é™ç»´åŸç†æ˜¯éš”ç¦»ä¿¡å·åˆ—å’Œå¿½ç•¥å™ªå£°åˆ—ã€‚

  - ç‰¹å¾è½¬æ¢æ˜¯ä½¿ç”¨åŸå§‹æ•°æ®é›†å»ºæ–°çš„åˆ—ï¼Œç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„æ•°æ®é›†ã€‚

### 5.1 ä¸»æˆåˆ†åˆ†æ

- ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼Œprincipal components analysisï¼‰

- å°†é«˜ç»´æ•°æ®æŠ•å½±è‡³ä½ç»´ç©ºé—´ï¼Œä½ç»´ç©ºé—´ä¸­çš„æ–°ç‰¹å¾å«**ä¸»æˆåˆ†**/è¶…çº§åˆ—ã€‚

- åªéœ€è¦å‡ ä¸ªä¸»æˆåˆ†å°±å¯ä»¥å‡†ç¡®è§£é‡Šæ•´ä¸ªæ•°æ®é›†ã€‚

- è½¬æ¢ç¤ºæ„ï¼š

  ![image-20211023171329525](image-20211023171329525-16349804108491.png)

- å·¥ä½œæµç¨‹ï¼š

  1. åˆ›å»ºæ•°æ®é›†çš„åæ–¹å·®çŸ©é˜µï¼›
  2. è®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼ï¼›
  3. ä¿ç•™å‰nä¸ªç‰¹å¾å€¼&ç‰¹å¾å‘é‡ï¼ˆæŒ‰ç‰¹å¾å€¼é™åºæ’åˆ—ï¼‰ï¼›
  4. ç”¨ä¿ç•™çš„ç‰¹å¾å‘é‡è½¬æ¢æ–°çš„æ•°æ®ç‚¹ã€‚

  ```python
  # åˆ›å»ºæ•°æ®é›†çš„åæ–¹å·®çŸ©é˜µ
  X, y = load_iris(return_X_y=True)
  plt.scatter(X[:, 0], X[:, 1], c=y)
  
  # è®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡
  eig_val_cov, eig_vec_cov = np.linalg.eig(cov_mat)   # è®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡
  top_2_vec = eig_vec_cov[:, :2]    # ä¿ç•™å‰ä¸¤ä¸ªç‰¹å¾å‘é‡
  
  # ä¿ç•™å‰ä¸¤ä¸ªç‰¹å¾å€¼
  X_new = np.dot(X, top_2_vec)      # æ•°æ®è½¬æ¢
  
  # ç”¨ä¿ç•™çš„ç‰¹å¾å‘é‡è½¬æ¢æ–°çš„æ•°æ®ç‚¹
  cov_mat = np.cov(X.T)      # åæ–¹å·®çŸ©é˜µ
  eig_val_cov, eig_vec_cov = np.linalg.eig(cov_mat)   # è®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡
  top_2_vec = eig_vec_cov[:, :2]    # ä¿ç•™å‰ä¸¤ä¸ªç‰¹å¾å‘é‡
  X_new = np.dot(X, top_2_vec)      # æ•°æ®è½¬æ¢
  
  ```

  - å‰åå¯¹æ¯”ï¼š

    ![image-20211023173013731](image-20211023173013731.png)

#### æ·±å…¥è§£é‡Šä¸»æˆåˆ†

- å¾ˆå¤šæœºå™¨å­¦ä¹ æ¨¡å‹ä¼šå‡è®¾è¾“å…¥çš„ç‰¹å¾æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥æ¶ˆé™¤ç›¸å…³ç‰¹å¾å¥½å¤„å¾ˆå¤§ã€‚
- PCAä¸­æ‰€æœ‰ä¸»æˆåˆ†éƒ½äº’ç›¸å‚ç›´ï¼Œæ„æ€æ˜¯å½¼æ­¤çº¿æ€§æ— å…³ã€‚
- åŸå§‹ç‰¹å¾é—´çš„ç›¸å…³æ€§ï¼š`np.corrcoef(iris_X.T) `
- ä¸»æˆåˆ†/è¶…çº§åˆ—é—´çš„ç›¸å…³æ€§ï¼š`np.corrcoef(pca_iris.T)`
- ä¸­å¿ƒåŒ–å’Œç¼©æ”¾å¯¹PCAçš„å½±å“
  - æ•°æ®ä¸­å¿ƒåŒ–ï¼ˆ iris_X-mean_vector ï¼‰ä¸å½±å“ç‰¹å¾å‘é‡ã€‚
  - å› ä¸ºåŸå§‹çŸ©é˜µå’Œä¸­å¿ƒåŒ–åçŸ©é˜µçš„åæ–¹å·®çŸ©é˜µç›¸åŒ
- æ³¨æ„
  - åœ¨ç‰¹å¾å·¥ç¨‹æˆ–æœºå™¨å­¦ä¹ ä¸­ï¼Œç‰¹å¾ç¼©æ”¾ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯å¥½çš„ã€‚
  - åœ¨å®è·µå’Œç”Ÿäº§ç¯å¢ƒä¸‹å»ºè®®è¿›è¡Œç¼©æ”¾ï¼Œä½†éœ€è¿›è¡Œæ€§èƒ½å¯¹æ¯”ã€‚
- æ¯ä¸ªä¸»æˆåˆ†/è¶…çº§åˆ—éƒ½æ˜¯ç‰¹å¾å‘é‡çš„çº¿æ€§ç»„åˆã€‚
- <img src="ç‰¹å¾å·¥ç¨‹.assets/image-20211024162709249.png" alt="image-20211024162709249" style="width:50%;" />
- æ·±å…¥è§£é‡Šä¸»æˆåˆ†ï¼šçº¿æ€§å˜æ¢
  - åŸå§‹åæ ‡ç³»çš„ç‰¹å¾å‘é‡ä¸æ˜¯å‚ç›´çš„ï¼ŒæŒ‡å‘æ•°æ®è‡ªç„¶éµå¾ªçš„æ–¹å‘ã€‚
  - æ–°åæ ‡ç³»ä¸­çš„ç‰¹å¾å‘é‡ç›¸äº’å‚ç›´ï¼Œä¹Ÿå°±æ˜¯æ–°çš„xè½´å’Œyè½´ã€‚
  - PCAæ˜¯ä¸€ç§ç‰¹å¾è½¬æ¢å·¥å…·ï¼Œä»¥åŸå§‹ç‰¹å¾çš„çº¿æ€§ç»„åˆæ„å»ºå‡ºå…¨æ–°çš„è¶…çº§ç‰¹å¾ã€‚
  - ä¸»æˆåˆ†ä¼šäº§ç”Ÿæ–°çš„ç‰¹å¾ï¼Œæœ€å¤§åŒ–æ•°æ®çš„æ–¹å·®ï¼Œå¹¶æŒ‰æ–¹å·®å¤§å°æ¥æ’åºã€‚

### 5.2 çº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLDAï¼‰

- çº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLDAï¼Œlinear discriminant analysisï¼‰

- çº¿æ€§åˆ¤åˆ«åˆ†ææ˜¯ç‰¹å¾å˜æ¢ç®—æ³•ï¼Œä¹Ÿæ˜¯æœ‰ç›‘ç£åˆ†ç±»å™¨ã€‚

- LDAçš„ç›®æ ‡æ˜¯æå–ä¸€ä¸ªæ–°çš„åæ ‡ç³»ï¼Œå°†åŸå§‹æ•°æ®é›†æŠ•å½±åˆ°ä¸€ä¸ªä½ç»´ç©ºé—´ä¸­ã€‚

- åœ¨ä½ç»´ç©ºé—´ä¸­è·å¾—æœ€ä½³çš„ç±»åˆ«å¯åˆ†æ€§ã€‚

- ![image-20211024170330346](ç‰¹å¾å·¥ç¨‹.assets/image-20211024170330346.png)

- LDAçš„å·¥ä½œæµç¨‹

  1. è®¡ç®—æ¯ä¸ªç±»åˆ«çš„å‡å€¼å‘é‡ï¼›
  2. è®¡ç®—ç±»å†…å’Œç±»é—´çš„æ•£å¸ƒçŸ©é˜µï¼›
  3. è®¡ç®—æ•£å¸ƒçŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼›
  4. é™åºæ’åˆ—ç‰¹å¾å€¼ï¼Œä¿ç•™å‰ä¸ªç‰¹å¾å‘é‡ï¼›
  5. ä½¿ç”¨å‰å‡ ä¸ªç‰¹å¾å‘é‡å°†æ•°æ®æŠ•å½±åˆ°æ–°ç©ºé—´ã€‚

  ```python
  from sklearn.datasets import load_iris
  import numpy as np
  
  iris = load_iris()
  iris_X, iris_y = iris.data, iris.target    # åˆ›å»ºXå’Œyå˜é‡ï¼Œå­˜å‚¨ç‰¹å¾å’Œå“åº”åˆ—
  label_dict = {i: k for i, k in enumerate(iris.target_names)}
  
  mean_vectors = []     # å­˜å‚¨æ¯ä¸ªç±»åˆ«çš„å‡å€¼å‘é‡
  for cl in [0, 1, 2]:
      class_mean_vector = np.mean(iris_X[iris_y == cl], axis=0)  # è®¡ç®—æ¯ç±»æ ·æœ¬å‡å€¼
      mean_vectors.append(class_mean_vector)         # å­˜å‚¨å‡å€¼å‘é‡
      print(label_dict[cl], class_mean_vector)
  
  # è®¡ç®—ç±»å†…æ•£å¸ƒçŸ©é˜µ
  S_W = np.zeros((4, 4))   # åˆå§‹ç±»å†…æ•£æ­¥çŸ©é˜µ
  for cl, mv in zip([0, 1, 2], mean_vectors):  # ä»0å¼€å§‹ï¼Œè®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ•£å¸ƒçŸ©é˜µ
      class_sc_mat = np.zeros((4, 4))          # æ¯ä¸ªç±»åˆ«çš„æ•£æ­¥çŸ©é˜µ
      for row in iris_X[iris_y == cl]:         # è®¿é—®è¯¥ç±»çš„æ¯ä¸ªæ ·æœ¬
          row, mv = row.reshape(4, 1), mv.reshape(4, 1)  # åˆ—å‘é‡
          class_sc_mat += (row-mv).dot((row-mv).T)       # 4 x 4çš„çŸ©é˜µ
      S_W += class_sc_mat   # æ•£å¸ƒçŸ©é˜µçš„å’Œ
  
  # ç±»è®¡ç®—é—´æ•£å¸ƒçŸ©é˜µ
  overall_mean = np.mean(iris_X, axis=0).reshape(4, 1)   # æ•°æ®é›†çš„å‡å€¼
  S_B = np.zeros((4, 4))                                 # åˆå§‹åŒ–ç±»é—´æ•£å¸ƒçŸ©é˜µ
  for i, mean_vec in enumerate(mean_vectors):
      n = iris_X[iris_y == i, :].shape[0]                # æ¯ç§èŠ±çš„æ•°é‡
      mean_vec = mean_vec.reshape(4, 1)                  # æ¯ç§èŠ±çš„åˆ—å‘é‡
      S_B += n * (mean_vec - overall_mean).dot((mean_vec - overall_mean).T)
  
  # è®¡ç®—çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡
  eig_vals, eig_vecs = np.linalg.eig(np.dot(np.linalg.inv(S_W), S_B))
  eig_vecs = eig_vecs.real
  eig_vals = eig_vals.real
  
  for i in range(len(eig_vals)):
      eigvec_sc = eig_vecs[:,i]
      print('Eigenvector {}: {}'.format(i+1, eigvec_sc))
      print('Eigenvalue {:}: {}'.format(i+1, eig_vals[i]))
  ```

- sk-learn å®ç°LDA

  ```python
  from sklearn.discriminant_analysis import LinearDiscriminantAnalysis
  X, y = load_iris(return_X_y=True)
  
  lda = LinearDiscriminantAnalysis(n_components=2)  # å®ä¾‹åŒ–LDAæ¨¡å—
  X_new_lda = lda.fit_transform(iris_X, iris_y)    # æ‹Ÿåˆå¹¶è½¬æ¢é¸¢å°¾èŠ±æ•°æ®
  pld.scatter([;, 0],X[:, 1], c =y)# ç»˜åˆ¶åŸå§‹æ•°æ®åˆ†å¸ƒå›¾
  plt.grid()# æ˜¾ç¤ºå‡ºç½‘æ ¼
  
  # æ–°ç”»ä¸€å¼ å¤„ç†åçš„æ•°æ®å›¾
  plt.figure()
  plt.scatter(X_new_lda[;, 0], X_new_lda[;, 1], c=y)
  plt.grid()
  ```

  <img src="ç‰¹å¾å·¥ç¨‹.assets/image-20211024171851485.png" alt="image-20211024171851485" style="zoom:50%;" />

  ```python
  lda.scallings_ # # ç‰¹å¾å‘é‡
  
  lda.explained_variance_ratio_   # ç±»ä¼¼è§£é‡Šæ–¹å·®
  ```

- è§£è¯»LDA
  - æ³¨æ„åˆ¤åˆ«å¼å¹¶ä¸ä¸æ•°æ®çš„æ–¹å·®ä¸€è‡´ï¼Œè€Œæ˜¯åŸºæœ¬ä¸ä¹‹å‚ç›´ï¼šç¬¦åˆç±»åˆ«çš„åˆ†ç¦»æƒ…å†µã€‚
  - åˆ¤åˆ«å¼ä¸å·¦å³ä¸¤ä¾§é¸¢å°¾èŠ±ä¹‹é—´çš„é—´éš”å‡ ä¹å¹³è¡Œï¼ŒLDAåœ¨è¯•å›¾æ•æ‰ä¸¤ä¸ªç±»åˆ«çš„åˆ†ç¦»æƒ…å†µã€‚

### 5.3 åº”ç”¨ç‰¹å¾è½¬æ¢

- ä»»åŠ¡ï¼šæ„å»ºirisåˆ†ç±»æ¨¡å‹

- ä¸åŒæ¡ä»¶ä¸‹æ¨¡å‹æ€§èƒ½æ¯”è¾ƒ

  - åŸºçº¿æ¨¡å‹
  - å•åˆ¤åˆ«å¼æ¨¡å‹
  - å•ä¸»æˆåˆ†æ¨¡å‹
  - ç»¼åˆä¼˜åŒ–æ¨¡å‹

- ```python
  from sklearn.neighbors import KNeighborsClassifier
  from sklearn.datasets import load_iris
  from sklearn.model_selection import cross_val_score
  from sklearn.pipeline import Pipeline
  
  X, y = load_iris(return_X_y=True) # å¯¼å…¥æ•°æ®
  
  # æ¨¡å‹æ€§èƒ½åŸºçº¿
  knn = KNeighborsClassifier()
  cross_val_score(knn, X, y, cv=5).mean()  #ä¸ç”¨ç‰¹å¾è½¬æ¢ï¼Œç”¨KNNè¿›è¡Œäº¤å‰æ£€éªŒ
  ```

  è¾“å‡ºï¼š0.9733333333333334

- ```python
  # å•åˆ¤åˆ«å¼æ¨¡å‹
  from sklearn.discriminant_analysis import LinearDiscriminantAnalysis
  
  lda_pipeline = Pipeline([('lda', LinearDiscriminantAnalysis(n_components=1)), ('knn', KNeighborsClassifier())])
  cross_val_score(lda_pipeline, X, y,cv=5).mean()
  ```

  è¾“å‡ºï¼š0.96666666666666666

- ```python
  # ä¸¤ä¸ªåˆ¤åˆ«å¼LDA
  from sklearn.discriminant_analysis import LinearDiscriminantAnalysis
  
  lda_pipeline = Pipeline([('lda', LinearDiscriminantAnalysis(n_components=1)), ('knn', KNeighborsClassifier())])
  cross_val_score(lda_pipeline, X, y,cv=5).mean()
  ```

  è¾“å‡ºï¼š0.97333333â€¦â€¦

- ```python
  # å•ä¸»æˆåˆ†æ¨¡å‹
  from sklearn.decomposition import PCA
  pca_pipeline = Pipeline([('pca', PCA(n_components=1)), ('knn', KNeighborsClassifier())])
  cross_val_score(pca_pipeline, X, y).mean()
  ```

  è¾“å‡ºï¼š0.9272875816993463

- ç»¼åˆè°ƒä¼˜

  - è¿›ä¸€æ­¥è”åˆä½¿ç”¨LDAå’ŒPCAï¼Œå¹¶ä½¿ç”¨GridSearchæ‰¾åˆ°ä¸‹åˆ—å‚æ•°çš„æœ€ä½³ç»„åˆï¼š
    - ç¼©æ”¾æ•°æ®ï¼šç”¨æˆ–ä¸ç”¨å‡å€¼/æ ‡å‡†å·®
    - PCAä¸»æˆåˆ†
    - LDAåˆ¤åˆ«å¼
    - KNNé‚»å±…

  ```python
  from sklearn.preprocessing import StandardScaler
  from sklearn.model_selection import GridSearchCV
  
  pipeline = Pipeline([
      ('scale', StandardScaler()),
      ('pca', PCA()),
      ('lda', LinearDiscriminantAnalysis()),
      ('clf', KNeighborsClassifier())
  ])
  
  pipeline_params = {
      'scale__with_std': [True, False],
      'scale__with_mean': [True, False],
      'pca__n_components': [1, 2, 3, 4],
      'lda__n_components': [1, 2],
      'knn__n_neighbors': range(1, 9)
  }
  
  grid = GridSearchCV(pipeline, pipeline_params)
  grid.fit(X, y)
  
  grid.best_estimator_, #  æœ€ä¼˜æ¨¡å‹
  grid.best_score_ # æœ€ä¼˜çš„å‚æ•°
  ```

### 5.4 å°ç»“

1. PCAå’ŒLDAéƒ½æ˜¯ç‰¹å¾è½¬æ¢å·¥å…·ï¼Œç”¨äºæ‰¾å‡ºæœ€ä¼˜çš„æ–°ç‰¹å¾ã€‚
2. LDAå±äºæœ‰ç›‘ç£å­¦ä¹ ï¼ŒPCAå±äºæ— ç›‘ç£å­¦ä¹ ã€‚
3. LDAç‰¹åˆ«ä¸ºç±»åˆ«åˆ†ç¦»è¿›è¡Œäº†ä¼˜åŒ–ï¼Œè€ŒPCAæ˜¯æ— ç›‘ç£çš„ï¼Œå°è¯•ç”¨æ›´å°‘çš„ç‰¹å¾è¡¨è¾¾æ–¹å·®ã€‚
4. ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªç®—æ³•åœ¨æµæ°´çº¿ä¸­ä¼šä¸€åŒä½¿ç”¨ã€‚
5. PCAå’ŒLDAéƒ½æ˜¯å¾ˆå¼ºå¤§çš„å·¥å…·ï¼Œä½†ä¹Ÿæœ‰å±€é™æ€§ï¼Œè¿™ä¸¤ä¸ªå·¥å…·éƒ½æ˜¯çº¿æ€§è½¬æ¢ã€‚

## 6. ç‰¹å¾å­¦ä¹ 

- PCAå’ŒLDAå­˜åœ¨ç¼ºé™·ï¼šåªèƒ½çº¿æ€§å˜æ¢ã€‚

- ç‰¹å¾å­¦ä¹ ï¼š

  - ä»è¾“å…¥çš„æ•°æ®ä¸­å­¦ä¹ æ–°ç‰¹å¾ï¼Œä¸éœ€è¦å‡è®¾ã€‚
  - åˆ©ç”¨æ·±åº¦ç¥ç»ç½‘ç»œå®ç°é«˜çº§åˆ«çš„ç‰¹å¾å·¥ç¨‹ã€‚

  ![image-20211025145804099](ç‰¹å¾å·¥ç¨‹.assets/image-20211025145804099.png)

### 6.1 å—é™ç»å°”å…¹æ›¼æœºï¼ˆRBMï¼‰

- ä¸€ç§ç®€å•çš„æ·±åº¦å­¦ä¹ æ¶æ„ï¼Œæ ¹æ®æ•°æ®çš„æ¦‚ç‡æ¨¡å‹å­¦ä¹ ä¸€å®šæ•°é‡çš„æ–°ç‰¹å¾ã€‚

- RBMæ˜¯ä¸€ä¸ªæµ…å±‚ï¼ˆä¸¤å±‚ï¼‰çš„ç¥ç»ç½‘ç»œï¼Œå±äºæ·±åº¦ä¿¡å¿µç½‘ç»œï¼ˆDBNï¼Œdeep belief networkï¼‰çš„ä¸€ç§ã€‚

- ç½‘ç»œå‘å‰ä¼ è¾“

  - å±‚é—´è¿æ¥ï¼Œå±‚å†…ä¸è¿æ¥ï¼›èŠ‚ç‚¹ç‹¬ç«‹åœ°åˆ›é€ æƒé‡å’Œåå·®ï¼›æœ€ç»ˆè·å–ç‹¬ç«‹ç‰¹å¾ã€‚

  ![image-20211025150134836](ç‰¹å¾å·¥ç¨‹.assets/image-20211025150134836.png)

- æ•°æ®é‡å»º

  - è¾“å‡ºå˜è¾“å…¥ï¼›ä»åå¾€å‰ä¼ ï¼›æƒå€¼ä¸å‰å‘ä¼ è¾“ä¸€è‡´

    ![image-20211025150848536](ç‰¹å¾å·¥ç¨‹.assets/image-20211025150848536-16351457301251.png)

  - å­¦ä¹ è¿‡ç¨‹ï¼šè°ƒæ•´æƒå€¼ã€é˜ˆå€¼ï¼Œä½¿å¾—é‡å»ºè¾“å‡ºä¸åŸå§‹è¾“å…¥å°½å¯èƒ½ç›¸ç­‰

    ![image-20211025151055924](ç‰¹å¾å·¥ç¨‹.assets/image-20211025151055924.png)

  - > - RBMé€šè¿‡å°†æ¿€æ´»ä¿¡æ¯è¿›è¡Œåå‘ä¼ å¯¼è·å–åŸå§‹è¾“å…¥çš„è¿‘ä¼¼å€¼ï¼Œåœ¨è®­ç»ƒå¼€å§‹æ—¶ï¼Œæƒé‡æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼ˆæ ‡å‡†åšæ³•ï¼‰ï¼Œè¿‘ä¼¼å€¼æœ‰å¯èƒ½ç›¸å·®å¾ˆå¤§ã€‚é€šè¿‡åå‘ä¼ æ’­è°ƒæ•´æƒé‡ï¼Œæœ€å°åŒ–åŸå§‹è¾“å…¥å’Œè¿‘ä¼¼å€¼çš„è·ç¦»ã€‚æˆ‘ä»¬é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œ**ç›´åˆ°è¿‘ä¼¼å€¼å°½å¯èƒ½æ¥è¿‘åŸå§‹çš„è¾“å…¥**
    > - è¿™ä¸ªè¿‡ç¨‹çš„æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªç½‘ç»œï¼Œç½‘ç»œ**è¾“å‡ºç»“æœå°±æ˜¯æ–°çš„ç‰¹å¾**ã€‚

  - è®­ç»ƒå®Œæˆåï¼Œç½‘ç»œå‰å‘è¾“å‡ºå€¼å³ä¸ºæ ·æœ¬ç‰¹å¾ã€‚

    ![image-20211025151729208](ç‰¹å¾å·¥ç¨‹.assets/image-20211025151729208.png)

### 6.2 MNISTæ‰‹å†™æ•°å­—è¯†åˆ«

- åŠ å…¥ç‰¹å¾è½¬æ¢

  ![image-20211025152841467](ç‰¹å¾å·¥ç¨‹.assets/image-20211025152841467.png)

- Scikit-learnå®ç°

  - ä¼¯åŠªåˆ©å—é™ç»å°”å…¹æ›¼æœºï¼šBernoulliRBM
  - è¯¥æ¨¡å‹å‡å®šè¾“å…¥æ˜¯äºŒè¿›åˆ¶çš„å€¼ï¼Œæˆ–è€…æ˜¯0~1çš„æ•°ã€‚

- ä¿®æ”¹ä¸€ä¸‹åŸå§‹æ•°æ®é›†ï¼Œåªè€ƒè™‘ç¡¬ç¼–ç çš„é»‘ç™½åƒç´ å¼ºåº¦ï¼š

  1.å°†åƒç´ çš„å€¼ç¼©æ”¾åˆ°0ï½1ï¼›

  2.å¦‚æœè¶…è¿‡0.5ï¼Œå°†å€¼å˜æˆçœŸï¼Œå¦åˆ™ä¸ºå‡ã€‚

```python
import numpy as np
import matplotlib.pyplot as plt
# è¯»å–æ•°æ®
images = np.genfromtxt('data/mnist_train.csv', delimiter=',')
images.shape # (6000, 785)

# MNISTæ•°æ®é›†åŒ…æ‹¬6000ä¸ª0ï½9çš„æ‰‹å†™æ•°å­—å›¾åƒï¼Œæ¯å¼ å›¾åƒåŒ…æ‹¬784ä¸ªåƒç´ å€¼åŠä¸€ä¸ªæ ‡ç­¾ã€‚
images_X, images_y = images[:, 1:], images[:, 0]

# æŸ¥çœ‹å‰5å¼ ç…§ç‰‡
for i in range(5):
    plt.figure()
    plt.imshow(images_X[i].reshape(28, 28), cmap=plt.cm.gray_r)# cmapå‚æ•°è°ƒæ•´æˆç°åº¦
    
# å½’ä¸€åŒ–æ“ä½œï¼Œå½¢æˆäºŒåˆ†åƒç´ ï¼ˆé»‘æˆ–ç™½ï¼‰
images_X = (images_X/255 >= 0.5).astype(float)
# æŸ¥çœ‹äºŒåˆ†åƒç´ çš„å›¾ç‰‡
for i in range(5):
    plt.figure()
    plt.imshow(images_X[i].reshape(28, 28), cmap=plt.cm.gray_r)
    
```

- PCAç‰¹å¾è½¬åŒ–

  ```python
  # PCAç‰¹å¾æ¢ç´¢
  # åˆ©ç”¨PCAè¿›è¡Œç‰¹å¾æ¢ç´¢
  from sklearn.decomposition import PCA
  pca = PCA(n_components=784)
  pca.fit(images_X)
  
  # ç»˜åˆ¶å‰ä¸€ç™¾ä¸ªç‰¹å¾å‘é‡çš„å›¾
  plt.figure(figsize=(10, 10))
  for i, comp in enumerate(pca.components_):
      plt.subplot(10, 10, i + 1)
      plt.imshow(comp.reshape((28, 28)), cmap=plt.cm.gray_r)
      plt.xticks(())
      plt.yticks(())
  plt.suptitle('100 components extracted by PCA')
  plt.show()# å¯ä»¥çœ‹å‡º100ä¸ªç‰¹å¾å‘é‡é€æ¸æ…¢æ…¢æ¨¡ç³Šï¼ˆéšç€ä¿¡æ¯é‡çš„å‡å°‘),å¯ä»¥æ¨æµ‹ä¸»è¦æ˜¯å‰é¢å‡ ä¸ªçš„ä¿¡æ¯é‡æ¯”è¾ƒæœ‰ä½œç”¨ã€‚PCAçš„ä¸»æˆåˆ†ä¼šå¾ˆå¿«å˜å¾—æ‰­æ›²ã€‚
  
  full_pca = PCA(n_components=784)
  full_pca.fit(images_X)
  plt.plot(np.cumsum(full_pca.explained_variance_ratio_))
  plt.grid()
  ```

  ![image-20211025155613973](ç‰¹å¾å·¥ç¨‹.assets/image-20211025155613973.png)

  ![image-20211025154830806](ç‰¹å¾å·¥ç¨‹.assets/image-20211025154830806.png)

  - å¯ä»¥çœ‹åˆ°å‰400ä¸ªç‰¹å¾å·²ç»åŸºæœ¬è¦†ç›–æ‰€æœ‰ã€‚

- ä»MNISTä¸­æå–RBMç‰¹å¾

  ```python
  from sklearn.neural_network import BernoulliRBM
  
  rbm = BernoulliRBM(n_components=100, random_state=10) 
  rbm.fit(images_X)
  rbm.components_.shape #(100, 784)
  
  # ç»˜åˆ¶RBMç»„ä»¶ï¼ˆæƒå€¼å‘é‡çš„è¡¨ç¤ºï¼‰
  plt.figure(figsize=(10, 10))
  for i, comp in enumerate(rbm.components_):
      plt.subplot(10, 10, i + 1)
      plt.imshow(comp.reshape((28, 28)), cmap=plt.cm.gray_r)
      plt.xticks(())
      plt.yticks(())
  plt.suptitle('100 components extracted by RBM')
  plt.show()# ç”»çš„æ˜¯æƒå€¼ç‰¹å¾ï¼Œä¸æ˜¯æ–°ç‰¹å¾
  # RBMç‰¹å¾å¥½åƒåœ¨æå–ä¸åŒçš„å½¢çŠ¶å’Œç¬”åˆ’ã€‚
  images_X_New = rbm.transform(images_X) # æ–°ç‰¹å¾
  
  
  ```

  ![image-20211025155556046](ç‰¹å¾å·¥ç¨‹.assets/image-20211025155556046.png)

- æ„å»ºæ¨¡å‹

  - ä»¥åŸå§‹åƒç´ å€¼ä½œä¸ºè¾“å…¥åº”ç”¨çº¿æ€§æ¨¡å‹
  - åŠ å…¥PCAç‰¹å¾è½¬æ¢
  - åŠ å…¥RBMç‰¹å¾è½¬æ¢

  > - åœ¨åŸå§‹åƒç´ ä¸Šè¿è¡Œé€»è¾‘å›å½’ï¼Œè·å–ä¸€ä¸ªåŸºçº¿æ¨¡å‹ã€‚
  >
  > - å†çœ‹PCAå’ŒRBMèƒ½å¦è®©åŒä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨è¡¨ç°å¾—æ›´å¥½ã€‚

- æ„å»ºåŸºçº¿æ¨¡å‹

  ```python
  from sklearn.linear_model import LogisticRegression
  from sklearn.model_selection import GridSearchCV
  
  lr = LogisticRegression()  # åˆ›å»ºé€»è¾‘å›å½’
  params = {'C': [0.1, 1, 100]}  
  # å‚æ•°è®¾ç½®
  
  grid = GridSearchCV(lr, params)              
  # å®ä¾‹åŒ–ç½‘æ ¼æœç´¢ç±»
  
  grid.fit(images_X, images_y)                
  # æ‹Ÿåˆæ•°æ®
  
  print(grid.best_params_, grid.best_score_)   # æœ€ä½³å‚æ•°ï¼š{'C': 0.1} 0.8908333333333334
  ```

- åŠ å…¥PCAè¿›è¡Œæ¨¡å‹ä¼˜åŒ–

  ```python
  from sklearn.pipeline import Pipeline
  
  pca_parms = {'pca__n_components': [50, 100, 200, 300], 'clf__C': [0.1, 1, 10]}
  
  pca_pipeline = Pipeline(steps=[('pca', PCA(n_components=100)), ('clf', LogisticRegression())])
  
  grid = GridSearchCV(pca_pipeline, pca_parms)
  grid.fit(images_X, images_y)
  
  grid.best_score_, grid.best_estimator_
  # 0.886666 æœ‰æ‰€ä¸‹é™
  ```

- åŠ å…¥RBMè¿›è¡Œæ¨¡å‹ä¼˜åŒ–

  ```python
  from sklearn.neural_network import BernoulliRBM
  
  bm_params = {'rbm__n_components': [50, 100, 200], 'clf__C': [0.1, 1, 10]}
  
  rbm_pipeline = Pipeline([('rbm', BernoulliRBM()), ('clf', LogisticRegression())])
  
  grid = GridSearchCV(rbm_pipeline, rbm_params)
  grid.fit(images_X, images_y)                              
  grid.best_score_, grid.best_estimator_
  #0.9206, BernoulliRBM(batch_size=10, learning_rate=0.1,n_components=200, n_iter=10, random_state=None,verbose=0))
  ```

### 6.3 å¤šå±‚å—é™ç»å°”å…¹æ›¼æœº

â€¦â€¦





